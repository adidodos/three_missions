rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    // Helper: 인증된 사용자인지 확인
    function isAuthenticated() {
      return request.auth != null;
    }

    // Helper: 해당 uid가 본인인지 확인
    function isOwner(uid) {
      return request.auth.uid == uid;
    }

    // MVP: "default" 크루만 사용
    // 인증된 사용자는 읽기/쓰기 모두 가능
    match /crews/{crewId} {
      allow read: if isAuthenticated();
      allow create: if isAuthenticated();
      allow update, delete: if isAuthenticated()
        && resource.data.ownerUid == request.auth.uid;

      // Members 컬렉션
      match /members/{memberId} {
        allow read: if isAuthenticated();
        allow create: if isAuthenticated();
        allow update, delete: if isAuthenticated();
      }

      // Exercise Types 컬렉션
      match /exerciseTypes/{typeId} {
        allow read: if isAuthenticated();
        allow create: if isAuthenticated();
        allow update, delete: if isAuthenticated();
      }

      // Logs 컬렉션
      match /logs/{logId} {
        allow read: if isAuthenticated();
        allow create: if isAuthenticated();
        // 본인이 작성한 로그만 수정/삭제 가능
        allow update, delete: if isAuthenticated()
          && resource.data.createdByUid == request.auth.uid;
      }
    }
  }
}
